<script
  src="https://giscus.app/client.js"
  data-repo="LeafEvans/leafevans.github.io"
  data-repo-id="R_kgDOPSoBtU"
  data-category="Comments"
  data-category-id="DIC_kwDOPSoBtc4CluJp"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="bottom"
  data-theme="https://leafevans.github.io/css/giscus-fire-light.css"
  data-lang="zh-CN"
  crossorigin="anonymous"
  async
></script>

<script>
  window.addEventListener("load", function () {
    function getThemeUrl() {
      const isDark = document.documentElement.classList.contains("dark");
      return isDark
        ? "https://leafevans.github.io/css/giscus-fire-dark.css"
        : "https://leafevans.github.io/css/giscus-fire-light.css";
    }

    function setGiscusTheme() {
      const giscusFrame = document.querySelector("iframe.giscus-frame");
      if (giscusFrame) {
        try {
          giscusFrame.contentWindow.postMessage(
            { giscus: { setConfig: { theme: getThemeUrl() } } },
            "https://giscus.app"
          );
        } catch (error) {
          console.warn("Failed to set Giscus theme:", error);
        }
      }
    }

    const themeObserver = new MutationObserver(setGiscusTheme);
    themeObserver.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["class"],
    });

    const giscusContainer = document.querySelector(".giscus");
    if (giscusContainer) {
      const iframeObserver = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.addedNodes.forEach((node) => {
            if (
              node.nodeName === "IFRAME" &&
              node.classList.contains("giscus-frame")
            ) {
              node.addEventListener("load", () => {
                setTimeout(setGiscusTheme, 200);
              });
            }
          });
        });
      });

      iframeObserver.observe(giscusContainer, {
        childList: true,
        subtree: true,
      });
    }

    setTimeout(setGiscusTheme, 500);
  });
</script>
